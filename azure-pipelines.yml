trigger:
- main

pool:
  name: Default  # Asegúrate de que este es el nombre correcto del pool de agentes

variables:
  acrLoginServer: $(acrLoginServer)
  dockerRegistryServiceConnection: 8PKPz2WBacrdevopsg1

steps:
- script: |
    python3 --version  # Verifica que está utilizando la versión correcta de Python
    python3 -m venv venv
    source venv/bin/activate
    pip install -r app/requirements.txt
    pytest app/test_app.py
  displayName: 'Run tests'

- task: Docker@2
  inputs:
    command: buildAndPush
    repository: $(acrLoginServer)/order-service
    dockerfile: 'Dockerfile'
    containerRegistry: $(dockerRegistryServiceConnection)
    tags: |
      $(Build.BuildId)
  displayName: 'Build and Push Docker image'
